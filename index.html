<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SIAP Pricetag</title>
    <link rel="icon" type="image/png" href="https://siap.cimory.com/siap/assets/production/images/logo_turbagi.png">
    <link rel="apple-touch-icon" href="https://siap.cimory.com/siap/assets/production/images/logo_turbagi.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        html {
            height: 100%;
            width: 100%;
        }

        body {
            height: 100%;
            width: 100%;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .loading-container {
            text-align: center;
            width: 100%;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            z-index: 9999;
            overflow: hidden;
        }

        .loading-logo {
            width: 60vw;
            height: auto;
            max-width: 200px;
            animation: logoFloat 3s ease-in-out infinite;
            -webkit-user-drag: none;
            user-drag: none;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        .loading-spinner {
            width: 15vw;
            height: 15vw;
            max-width: 50px;
            max-height: 50px;
            border: 3px solid rgba(52, 152, 219, 0.1);
            border-top: 3px solid #3498db;
            border-radius: 50%;
            margin: 20px auto;
            animation: spin 1s linear infinite;
            position: relative;
        }

        .loading-spinner::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 2px solid rgba(52, 152, 219, 0.2);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .loading-text {
            color: #666;
            font-size: 16px;
            margin-top: 20px;
            font-weight: 500;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
            animation-delay: 0.5s;
        }

        .loading-dots {
            display: inline-block;
            animation: dots 1.5s infinite;
        }

        @keyframes logoFloat {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
            100% { transform: translateY(0) scale(1); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60% { content: '...'; }
            80%, 100% { content: ''; }
        }

        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 50%;
            animation: particleFloat 3s infinite;
        }

        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        .version-text {
            position: relative;
            text-align: right;
            padding: 5px 15px;
            color: #666;
            font-size: 12px;
            z-index: 1000;
            background: transparent;
            border-radius: 0;
            box-shadow: none;
            animation: blink 3s ease-in-out infinite;
            margin-bottom: 5px;
            width: 100%;
        }

        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .main-content {
            display: none;
            position: relative;
            width: 100%;
            min-height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 0;
        }

        .header-sticky-container {
            position: sticky;
            top: 0;
            z-index: 100;
            background: #f5f5f5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding-top: 0;
            width: 100%;
        }

        /* Tambahkan style untuk search container */
        .search-container {
            position: relative;
            background: transparent;
            padding: 0 15px 10px 15px;
            margin-bottom: 0;
            box-shadow: none;
            margin-top: 0;
        }

        .search-box {
            width: 100%;
            padding: 12px 20px;
            padding-left: 40px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            background: white;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .search-box:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
        }

        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .search-result-item:hover {
            background: #f5f5f5;
        }

        .search-result-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            border-radius: 4px;
            background: #f8f8f8;
        }

        .search-result-info {
            flex: 1;
        }

        .search-result-name {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
        }

        .search-result-category {
            font-size: 12px;
            color: #666;
        }

        .search-result-barcode {
            font-size: 12px;
            color: #999;
            font-family: monospace;
        }

        .no-results {
            padding: 15px;
            text-align: center;
            color: #666;
            font-size: 14px;
        }

        .search-highlight {
            background-color: #fff3cd;
            padding: 0 2px;
            border-radius: 2px;
        }

        .category-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .category-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }

        .category-header {
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            background: #fff;
            border-bottom: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        .category-thumbnail {
            width: 100%;
            height: 80px;
            background: #f8f8f8;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .category-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            padding: 8px;
            background: white;
        }

        .category-name {
            font-size: 12px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 0 2px;
            text-align: center;
            width: 100%;
            justify-content: center;
        }

        .category-name::before {
            content: '';
            display: inline-block;
            width: 4px;
            height: 4px;
            background: #4CAF50;
            border-radius: 50%;
        }

        .category-arrow {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
            opacity: 0.6;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 4px;
        }

        .category-arrow.expanded {
            transform: rotate(180deg);
            opacity: 1;
        }

        .category-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            background: #fafafa;
            position: relative;
        }

        .category-content.expanded {
            max-height: 2000px;
            background: #fff;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            padding: 15px;
            padding-top: 50px;
            background: #fafafa;
            border-top: 1px solid #eee;
        }

        .product-item {
            background: white;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.03);
            cursor: pointer;
        }

        .product-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.08);
        }

        .product-item.selected {
            border: 2px solid #4CAF50;
            background: #f8fff8;
        }

        .product-item.selected::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(76, 175, 80, 0.05);
            border-radius: 10px;
            pointer-events: none;
        }

        .product-item.selected .product-name {
            color: #4CAF50;
        }

        .product-item.selected .product-barcode {
            background: #e8f5e9;
            color: #388E3C;
        }

        .product-image-container {
            position: relative;
            width: 100%;
            padding-top: 100%;
            margin-bottom: 8px;
            overflow: hidden;
            border-radius: 8px;
            background: #f8f8f8;
            transition: all 0.3s ease;
        }

        .product-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background-color: #fff;
            padding: 8px;
            transition: transform 0.3s ease;
        }

        .product-item:hover .product-image {
            transform: scale(1.05);
        }

        .product-name {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
            height: 34px;
        }

        .product-barcode {
            font-size: 11px;
            color: #666;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-family: monospace;
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 4px;
            display: inline-block;
        }

        .add-button {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.95);
            color: #4CAF50;
            border: 2px solid #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: scale(1);
            pointer-events: none;
        }

        .product-item.selected .add-button {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .select-all-button {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 28px;
            height: 28px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
            z-index: 2;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            opacity: 0;
            pointer-events: none;
        }

        .select-all-button svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .category-content.expanded .select-all-button {
            opacity: 1;
            pointer-events: auto;
        }

        .select-all-button:active {
            transform: scale(0.9);
        }

        .select-all-button.selected {
            background: #f44336;
        }

        .add-button:active {
            transform: scale(0.9);
        }

        .add-button.selected {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
            animation: pulse 0.3s ease;
        }

        .selected-products {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }

        .selected-count {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .button-group {
            display: flex;
            gap: 8px;
        }

        .clear-selection {
            padding: 8px 15px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .clear-selection svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .clear-selection:active {
            transform: scale(0.95);
            background: #d32f2f;
        }

        .view-barcode {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-barcode svg {
            width: 14px;
            height: 14px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .view-barcode:active {
            transform: scale(0.95);
            background: #388E3C;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0.3;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.3;
            }
        }

        /* Media query untuk memastikan tampilan portrait */
        @media screen and (orientation: portrait) {
            .loading-container {
                transform: none;
                width: 100%;
                height: 100vh;
                position: fixed;
                top: 0;
                left: 0;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .loading-logo {
                width: 60vw;
                max-width: 200px;
            }

            .loading-spinner {
                width: 15vw;
                height: 15vw;
                max-width: 50px;
                max-height: 50px;
            }

            .loading-text {
                font-size: 16px;
            }
        }

        /* Mencegah zoom pada input di mobile */
        input, textarea {
            font-size: 16px;
        }

        /* Menambahkan efek hover untuk desktop */
        @media (hover: hover) {
            .add-button:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
        }

        .barcode-container {
            display: none;
            width: 100%;
            height: 100%;
            background: white;
            padding: 20px;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 2000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }

        .barcode-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100%;
            gap: 20px;
            padding: 20px 0;
            touch-action: pan-y;
        }

        .barcode-image {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
        }

        .barcode-info {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 300px;
            position: relative;
        }

        .barcode-info::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: #4CAF50;
            border-radius: 2px;
        }

        .barcode-info::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 4px;
            background: #4CAF50;
            border-radius: 2px;
        }

        .barcode-name {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .barcode-number {
            font-size: 14px;
            color: #666;
        }

        .product-image-barcode {
            width: 180px;
            height: 180px;
            object-fit: contain;
            border-radius: 12px;
            background: #f8f8f8;
            padding: 8px;
            margin-bottom: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            transition: transform 0.3s ease;
        }

        .product-image-barcode::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #4CAF50;
            border-radius: 14px;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .product-image-barcode::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -4px;
            right: -4px;
            bottom: -4px;
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 16px;
            animation: rotate 10s linear infinite;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .product-image-barcode:hover {
            transform: scale(1.02);
        }

        .product-image-barcode:hover::before {
            opacity: 1;
            border-color: #388E3C;
        }

        .progress-container {
            width: 100%;
            max-width: 300px;
            margin: 15px 0;
            padding: 0 20px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.3s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 8px;
        }

        .barcode-navigation {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 0 20px;
            position: fixed;
            bottom: 30px;
            left: 0;
        }

        .nav-button {
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-button svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .nav-button:active {
            transform: scale(0.95);
        }

        .close-barcode {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-barcode svg {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .close-barcode:active {
            transform: scale(0.95);
        }

        .barcode-counter {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 16px;
            color: #666;
        }

        .category-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-y;
        }

        .category-popup-content {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            margin: 20px auto;
            position: relative;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            touch-action: pan-y;
        }

        .popup-header {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: white;
            border-radius: 12px 12px 0 0;
            z-index: 1;
        }

        .popup-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .popup-select-all {
            position: absolute;
            top: 12px;
            right: 50px;
            padding: 6px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .popup-select-all svg {
            width: 12px;
            height: 12px;
            stroke: currentColor;
            stroke-width: 2;
        }

        .close-popup {
            width: 28px;
            height: 28px;
            border: none;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-popup svg {
            width: 16px;
            height: 16px;
            stroke: #666;
            stroke-width: 2;
        }

        .popup-products {
            padding: 10px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
            min-height: 0;
            touch-action: pan-y;
        }

        .product-item {
            background: white;
            border-radius: 5px;
            padding: 4px;
            text-align: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            position: relative;
            display: flex;
            flex-direction: column;
            height: 100%;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.03);
            cursor: pointer;
        }

        .product-image-container {
            position: relative;
            width: 100%;
            padding-top: 100%;
            margin-bottom: 3px;
            overflow: hidden;
            border-radius: 3px;
            background: #f8f8f8;
            transition: all 0.3s ease;
        }

        .product-name {
            font-size: 9px;
            font-weight: 600;
            color: #333;
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.1;
            height: 20px;
        }

        .product-barcode {
            font-size: 8px;
            color: #666;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-family: monospace;
            background: #f5f5f5;
            padding: 1px 2px;
            border-radius: 2px;
            display: inline-block;
        }

        .add-button {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: rgba(255, 255, 255, 0.95);
            color: #4CAF50;
            border: 1px solid #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 2;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            transform: scale(1);
            pointer-events: none;
        }

        .add-button svg {
            width: 10px;
            height: 10px;
            stroke: currentColor;
            stroke-width: 2;
        }

        @media (max-width: 480px) {
            .popup-products {
                grid-template-columns: repeat(4, 1fr);
                gap: 5px;
                padding: 8px;
            }

            .product-item {
                padding: 3px;
            }

            .product-name {
                font-size: 8px;
                height: 18px;
            }

            .product-barcode {
                font-size: 7px;
            }
        }

        @media (max-width: 360px) {
            .popup-products {
                grid-template-columns: repeat(4, 1fr);
                gap: 4px;
                padding: 6px;
            }
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -20px); }
            15% { opacity: 1; transform: translate(-50%, 0); }
            85% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }

        .categories-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            padding: 8px;
            padding-bottom: 60px;
            width: 100%;
        }

        .category-card {
            background: white;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .category-header {
            padding: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            background: #fff;
            border-bottom: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        .category-thumbnail {
            width: 100%;
            height: 70px;
            background: #f8f8f8;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .category-name {
            font-size: 10px;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 0 1px;
            text-align: center;
            width: 100%;
            justify-content: center;
        }

        .category-name::before {
            content: '';
            display: inline-block;
            width: 3px;
            height: 3px;
            background: #4CAF50;
            border-radius: 50%;
        }

        @media (max-width: 480px) {
            .categories-container {
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 6px;
                padding: 6px;
            }
            .category-thumbnail {
                height: 60px;
            }
            .category-name {
                font-size: 9px;
            }
        }

        @media (max-width: 360px) {
            .categories-container {
                grid-template-columns: repeat(4, 1fr) !important;
                gap: 4px;
                padding: 4px;
            }
            .category-thumbnail {
                height: 50px;
            }
            .category-name {
                font-size: 8px;
            }
        }

        /* Responsive styles */
        @media screen and (min-width: 768px) {
            .categories-container {
                grid-template-columns: repeat(4, 1fr);
                gap: 20px;
                padding: 20px;
                max-width: 1200px;
                margin: 0 auto;
            }

            .category-card {
                max-width: 300px;
                margin: 0 auto;
            }

            .search-container {
                max-width: 600px;
                margin: 0 auto;
                padding: 0 20px 20px 20px;
            }

            .search-box {
                font-size: 16px;
                padding: 15px 25px;
                padding-left: 45px;
            }

            .search-icon {
                left: 30px;
                width: 20px;
                height: 20px;
            }

            .version-text {
                font-size: 14px;
                padding: 10px 20px;
            }
        }

        @media screen and (min-width: 1024px) {
            .categories-container {
                grid-template-columns: repeat(5, 1fr);
                gap: 25px;
                padding: 25px;
            }

            .category-card {
                max-width: 250px;
            }

            .search-container {
                max-width: 800px;
            }
        }

        @media screen and (max-width: 767px) {
            .categories-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
                padding: 10px;
            }

            .category-card {
                max-width: none;
            }

            .search-container {
                padding: 0 10px 10px 10px;
            }

            .search-box {
                font-size: 14px;
                padding: 10px 15px;
                padding-left: 35px;
            }

            .search-icon {
                left: 20px;
                width: 16px;
                height: 16px;
            }

            .version-text {
                font-size: 12px;
                padding: 5px 10px;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Smooth scroll behavior */
        html {
            scroll-behavior: smooth;
        }

        /* Loading screen responsive */
        @media screen and (min-width: 768px) {
            .loading-logo {
                width: 40vw;
                max-width: 300px;
            }

            .loading-spinner {
                width: 10vw;
                height: 10vw;
                max-width: 60px;
                max-height: 60px;
            }

            .loading-text {
                font-size: 18px;
            }
        }

        @media screen and (max-width: 767px) {
            .loading-logo {
                width: 60vw;
                max-width: 200px;
            }

            .loading-spinner {
                width: 15vw;
                height: 15vw;
                max-width: 50px;
                max-height: 50px;
            }

            .loading-text {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-container">
        <div class="loading-particles" id="particles"></div>
        <img src="https://siap.cimory.com/siap/assets/production/images/logo_turbagi.png" alt="Turbagi Logo" class="loading-logo">
        <div class="loading-spinner"></div>
        <div class="loading-text">Memuat Aplikasi<span class="loading-dots">...</span></div>
    </div>

    <div class="main-content">
        <!-- Tambahkan search container -->
        <div class="header-sticky-container">
            <div class="version-text">SIAP Pricetag V1.0 | mod by YPrtm</div>
            <div class="search-container">
                <div style="position: relative;">
                    <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <input type="text" class="search-box" placeholder="Cari produk atau barcode..." id="searchInput">
                    <div class="search-results" id="searchResults"></div>
                </div>
            </div>
        </div>
        <div class="categories-container">
            <!-- Card kategori akan ditambahkan secara dinamis -->
        </div>
    </div>

    <div class="selected-products">
        <div class="selected-count">0 Produk Dipilih</div>
    </div>

    <div class="barcode-container">
        <button class="close-barcode" onclick="closeBarcodeView()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
        </button>
        <div class="barcode-content">
            <div class="barcode-info">
                <img class="product-image-barcode" src="" alt="Product Image">
                <div class="barcode-name"></div>
                <div class="barcode-number"></div>
            </div>
            <img class="barcode-image" src="" alt="Barcode">
        </div>
        <div class="barcode-navigation">
            <button class="nav-button" onclick="previousBarcode()">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
                Sebelumnya
            </button>
            <button class="nav-button" onclick="nextBarcode()">
                Selanjutnya
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div class="progress-text"></div>
        </div>
    </div>

    <div class="category-popup">
        <div class="category-popup-content">
            <div class="popup-header">
                <div class="popup-title"></div>
                <button class="popup-select-all">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 5v14M5 12h14"/>
                    </svg>
                    Pilih Semua
                </button>
                <button class="close-popup">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="popup-products"></div>
        </div>
    </div>

    <script>
        // Data dalam format CSV
        const categoriesCSV = `
Kategori,Produk,Barcode,Gambar
Yogurt Drink 240 ml,Blueberry 240 ml,8993200661657,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-01.jpg
Yogurt Drink 240 ml,Strawberry 240 ml,8993200661305,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-02.jpg
Yogurt Drink 240 ml,Mixed Fruit 240 ml,8993200661350,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-06.jpg
Yogurt Drink 240 ml,Lychee 240 ml,8993200661299,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-03.jpg
Yogurt Drink 240 ml,Mixed Berry 240 ml,8993200663057,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-05.jpg
Yogurt Drink 240 ml,Original 240 ml,8993200663064,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Reguler-250ml-07.jpg
Yogurt Drink 240 ml,LF Strawberry Mango 240 ml,8993200665006,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Lowfat-250ml-05.jpg
Yogurt Drink 240 ml,LF Banana 240 ml,8993200664993,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-CYD-Lowfat-250ml-03.jpg
Squeeze 120 gr,Original 120 gr,8993200666935,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-Squeeze-140-g-03.jpg
Squeeze 120 gr,Strawberry 120 gr,8993200666942,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-Squeeze-140-g-01.jpg
Squeeze 120 gr,Blueberry 120 gr,8993200666959,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-Squeeze-140-g-02.jpg
Squeeze 120 gr,Mango Sticky Rice 120 gr,8993200661343,https://c.alfagift.id/product/1/1_A7741890002167_20240920102547063_base.jpg
Squeeze 120 gr,Purple Taro 120 gr,8993200668304,https://cimory.com/uploads/products/variant_claim_id_yyCiJD1631068524.png
Squeeze 120 gr,Brown Sugar 120 gr,8993200668335,https://c.alfagift.id/product/1/1_A7748960002167_20240920102914703_base.jpg
Squeeze Bites 120 gr,Strawberry 120 gr,899320069400,https://c.alfagift.id/product/1/1_A8166180002167_20240729112116757_base.jpg
Squeeze Bites 120 gr,Blueberry 120 gr,8993200669417,https://c.alfagift.id/product/1/1_A8166190002167_20240729112107465_base.jpg
Squeeze Bites 120 gr,Yuzu 120 gr,8993200669240,https://c.alfagift.id/product/1/1_A8166200002167_20240729112202921_base.jpg
Squeeze Bites 120 gr,Strawberry Lychee 120 gr,8993200669264,https://c.alfagift.id/product/1/1_A8166210002167_20240729112212806_base.jpg
Squeeze Bites 120 gr,Berry Blemd 120 gr,8993200669271,https://c.alfagift.id/product/1/1_A8269630002167_20250326140553498_base.jpg
Squeeze Bites 120 gr,Strawberry Manggo 120 gr,8993200669301,https://c.alfagift.id/product/1/1_A8269620002167_20250326140550195_base.jpg
Stick Yogurt 40 gr,Strawberry 40 gr,8993200668915,https://c.alfagift.id/product/1/1_A8006350002167_20230922143547780_base.jpg
Stick Yogurt 40 gr,Blueberry 40 gr,8993200668922,https://c.alfagift.id/product/1/1_A8006340002167_20230922143601946_base.jpg
Stick Yogurt 40 gr,Original 40 gr,8993200668908,https://c.alfagift.id/product/1/1_A8130210002167_20240515095655362_base.jpg
Stick Yogurt 40 gr,Mango Sticky Rice 40 gr,8993200669363,https://c.alfagift.id/product/1/1_A8130200002167_20240515094931491_base.jpg
Stick Yogurt 40 gr,Brown Sugar 40 gr,8993200669462,https://c.alfagift.id/product/1/1_A8212140002167_20241025144858561_base.jpg
Eatmilk 80 gr,Chocolate 80 gr,8993200669561,https://c.alfagift.id/product/1/1_A8279130002167_20250508164840255_base.jpg
Eatmilk 80 gr,Marie Biscuits 80 gr,8993200669622,https://c.alfagift.id/product/1/1_A8279140002167_20250508164850278_base.jpg
Eatmilk 80 gr,Chocolate Hazelnut 80 gr,8993200669592,https://c.alfagift.id/product/1/1_A8279120002167_20250508164830616_base.jpg
Kanzler Singles Sosis 60 gr,Singles Keju 60 gr,8993200346318,https://cimory.com/uploads/products/variant_claim_id_9oWOvV1704246353.jpg
Kanzler Singles Sosis 60 gr,Singles Original 60 gr,8993200346319,https://cimory.com/uploads/products/variant_claim_id_mVfetA1704246621.jpg
Kanzler Singles Sosis 60 gr,Singles Mini 60 gr,8993200347315,https://cimory.com/uploads/products/meat_0027_KS-New-Packaging-Mini.jpg
Kanzler Singles Sosis 60 gr,Singles Hot 60 gr,8993200345717,https://cimory.com/uploads/products/variant_claim_id_pRF1MO1704246501.jpg
Kanzler Singles Sosis 60 gr,Singles Gochujang 60 gr,8993200668243,https://cimory.com/uploads/products/variant_claim_id_AvXrnk1704245879.jpg
Kanzler Singles Bakso 55 gr,Bakso Original 55 gr,8993200668496,https://cimory.com/uploads/products/variant_claim_id_XjrEoN1704246302.jpg
Kanzler Singles Bakso 55 gr,Bakso Keju 55 gr,8993200668502,https://cimory.com/uploads/products/variant_claim_id_WLFqEW1704246268.jpg
Kanzler Singles Bakso 55 gr,Bakso Hot 55 gr,8993200668984,https://cimory.com/uploads/products/variant_claim_id_0hZtVH1704247446.jpg
Kanzler Singles Bakso 55 gr,Bakso Gochujang 55 gr,8993200000005,https://c.alfagift.id/product/1/1_A8248640002167_20250122163637397_base.jpg
Mini Yogurt 4x65 ml,Blueberry 4x65 ml,8993200664061,https://c.alfagift.id/product/1/1_A6880780001089_20250609095045752_base.jpg
Mini Yogurt 4x65 ml,Strawberry 4x65 ml,8993200664054,https://c.alfagift.id/product/1/1_A6880770001089_20250609095035175_base.jpg
Milk 250 ml,Chocolate 250 ml,8993200666133,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-02.jpg
Milk 250 ml,Bebas Laktosa 250 ml,8993200666157,https://cimory.com/uploads/products/variant_claim_id_V6sClv1701335628.jpg
Milk 250 ml,Hazelnut 250 ml,8993200666805,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-09.jpg
Milk 250 ml,Chocomalt 250 ml,8993200666898,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-11.jpg
Milk 250 ml,Almond 250 ml,8993200666836,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-12.jpg
Milk 250 ml,Cashew 250 ml,8993200666867,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-10.jpg
Milk 250 ml,Marie Biscuits 250 ml,8993200666928,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-13.jpg
Milk 250 ml,Strawberry 250 ml,8993200666218,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-250ml-03.jpg
Milk 250 ml,Tiramisu 250 ml,8993200667246,https://c.alfagift.id/product/1/1_A7806670002167_20220905132638209_base.jpg
Milk 250 ml,Salted Caramel 250 ml,8993200667215,https://cimory.com/uploads/products/variant_claim_id_Yc692r1701336911.jpg
Milk 250 ml,Chocomint 250 ml,8993200668342,https://cimory.com/uploads/products/variant_claim_id_pUIazJ1701334693.jpg
Milk 250 ml,Peanut Butter 250 ml,8993200667185,https://cimory.com/uploads/products/variant_claim_id_faxBEE1701334288.jpg
Milk 250 ml,Matcha 250 ml,8993200666201,https://c.alfagift.id/product/1/1_A8121880002167_20240405134230448_base.jpg
Milk 125 ml,Chocolate 125 ml,8993200666263,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-125ml-01.jpg
Milk 125 ml,Strawberry 125 ml,8993200666348,https://cimory.com/uploads/products/Preview---Claim-Products-(Indonesia)-UHT-125ml-02.jpg
Milk 750 ml,Almond 750 ml,8993200667659,https://c.alfagift.id/product/1/1_A7942710002167_20250507140226800_base.jpg
Milk 750 ml,Chocolate 750 ml,8993200667727,https://c.alfagift.id/product/1/1_A8279380002167_20250509134510212_base.jpg

`;

        // Fungsi untuk mengkonversi CSV ke format yang dibutuhkan
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            const data = {};
            
            // Mulai dari baris kedua (setelah header)
            for (let i = 1; i < lines.length; i++) {
                const [kategori, produk, barcode, gambar] = lines[i].split(',');
                
                if (!data[kategori]) {
                    data[kategori] = [];
                }
                
                data[kategori].push([produk, barcode, gambar]);
            }
            
            // Konversi ke format array yang dibutuhkan
            return Object.entries(data);
        }

        // Konversi CSV ke format yang dibutuhkan
        const categories = parseCSV(categoriesCSV);

        // Fungsi untuk menambah data dari CSV
        function addFromCSV(csvData) {
            const newData = parseCSV(csvData);
            newData.forEach(([category, products]) => {
                const existingCategory = categories.find(cat => cat[0] === category);
                if (existingCategory) {
                    // Tambah produk ke kategori yang sudah ada
                    products.forEach(product => {
                        if (!existingCategory[1].some(p => p[1] === product[1])) {
                            existingCategory[1].push(product);
                        }
                    });
                } else {
                    // Tambah kategori baru
                    categories.push([category, products]);
                }
            });
            displayCategories(); // Refresh tampilan
        }

        // Fungsi untuk mengekspor data ke CSV
        function exportToCSV() {
            let csv = 'Kategori,Produk,Barcode,Gambar\n';
            categories.forEach(([category, products]) => {
                products.forEach(([product, barcode, image]) => {
                    csv += `${category},${product},${barcode},${image}\n`;
                });
            });
            return csv;
        }

        // Fungsi untuk menyimpan data ke file
        function saveToFile() {
            const csv = exportToCSV();
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'products.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Fungsi untuk membaca file CSV
        function readCSVFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const csv = e.target.result;
                addFromCSV(csv);
            };
            reader.readAsText(file);
        }

        // Menyimpan produk yang dipilih
        let selectedProducts = new Set();

        // Fungsi untuk menyimpan data ke localStorage
        function saveSelectedProducts() {
            localStorage.setItem('selectedProducts', JSON.stringify(Array.from(selectedProducts)));
        }

        // Fungsi untuk memulihkan data dari localStorage
        function loadSelectedProducts() {
            const savedProducts = localStorage.getItem('selectedProducts');
            if (savedProducts) {
                selectedProducts = new Set(JSON.parse(savedProducts));
                // Update tampilan tombol
                selectedProducts.forEach(barcode => {
                    const button = document.querySelector(`.add-button[onclick="toggleProduct('${barcode}')"]`);
                    if (button) {
                        button.classList.add('selected');
                        button.textContent = '';
                    }
                });
                updateSelectedCount();
            }
        }

        // Fungsi untuk menambah kategori baru
        function addCategory(categoryName, products) {
            categories.push([categoryName, products]);
            displayCategories(); // Refresh tampilan
        }

        // Fungsi untuk menambah produk ke kategori
        function addProductToCategory(categoryName, productName, barcode, imageUrl) {
            const categoryIndex = categories.findIndex(cat => cat[0] === categoryName);
            if (categoryIndex !== -1) {
                categories[categoryIndex][1].push([productName, barcode, imageUrl]);
                displayCategories(); // Refresh tampilan
            }
        }

        // Contoh penggunaan:
        /*
        // Menambah kategori baru
        addCategory("Susu 1L", [
            ["Coklat 1L", "8993200661234", "https://example.com/coklat.jpg"],
            ["Strawberry 1L", "8993200661235", "https://example.com/strawberry.jpg"]
        ]);

        // Menambah produk ke kategori yang sudah ada
        addProductToCategory("Yogurt Drink 240 ml", 
            "Strawberry 240 ml", 
            "8993200661658", 
            "https://example.com/strawberry.jpg"
        );
        */

        // Modifikasi fungsi createCategoryCard untuk format baru
        function createCategoryCard(category) {
            const [categoryName, products] = category;
            const firstProduct = products[0];
            return `
                <div class="category-card">
                    <div class="category-header" onclick="showCategoryPopup('${categoryName}')">
                        <div class="category-thumbnail">
                            <img src="${firstProduct[2]}" alt="${categoryName}">
                        </div>
                        <div class="category-name">${categoryName}</div>
                    </div>
                </div>
            `;
        }

        // Fungsi untuk menyimpan gambar ke cache
        async function cacheImage(url, key) {
            try {
                const cache = await caches.open('image-cache');
                const response = await fetch(url, {
                    mode: 'cors',
                    credentials: 'omit'
                });
                if (!response.ok) throw new Error('Network response was not ok');
                await cache.put(key, response.clone());
                return true;
            } catch (error) {
                console.error('Error caching image:', error);
                return false;
            }
        }

        // Fungsi untuk mengambil gambar dari cache
        async function getCachedImage(key) {
            try {
                const cache = await caches.open('image-cache');
                const response = await cache.match(key);
                if (response) {
                    const blob = await response.blob();
                    return URL.createObjectURL(blob);
                }
                return null;
            } catch (error) {
                console.error('Error getting cached image:', error);
                return null;
            }
        }

        // Fungsi untuk menyimpan barcode ke cache
        async function cacheBarcode(barcode) {
            try {
                const cache = await caches.open('barcode-cache');
                const barcodeUrl = `https://barcodeapi.org/api/code128/${barcode}`;
                const response = await fetch(barcodeUrl, {
                    mode: 'cors',
                    credentials: 'omit'
                });
                if (!response.ok) throw new Error('Network response was not ok');
                await cache.put(barcode, response.clone());
                return true;
            } catch (error) {
                console.error('Error caching barcode:', error);
                return false;
            }
        }

        // Fungsi untuk mengambil barcode dari cache
        async function getCachedBarcode(barcode) {
            try {
                const cache = await caches.open('barcode-cache');
                const response = await cache.match(barcode);
                if (response) {
                    const blob = await response.blob();
                    return URL.createObjectURL(blob);
                }
                return null;
            } catch (error) {
                console.error('Error getting cached barcode:', error);
                return null;
            }
        }

        // Modifikasi fungsi showCategoryPopup untuk menggunakan cache
        async function showCategoryPopup(categoryName) {
            const category = categories.find(cat => cat[0] === categoryName);
            if (!category) return;

            const popup = document.querySelector('.category-popup');
            const popupTitle = popup.querySelector('.popup-title');
            const popupProducts = popup.querySelector('.popup-products');
            const selectAllButton = popup.querySelector('.popup-select-all');

            popupTitle.textContent = categoryName;
            
            // Tampilkan loading state
            popupProducts.innerHTML = '<div class="loading">Loading...</div>';
            popup.style.display = 'block';

            try {
                // Cache gambar dan barcode secara asynchronous
                const cachePromises = category[1].map(async product => {
                    await Promise.all([
                        cacheImage(product[2], product[1]),
                        cacheBarcode(product[1])
                    ]);
                });

                // Tunggu semua proses caching selesai
                await Promise.all(cachePromises);

                // Update tampilan produk
            popupProducts.innerHTML = category[1].map(product => `
                <div class="product-item ${selectedProducts.has(product[1]) ? 'selected' : ''}" 
                     onclick="toggleProduct('${product[1]}', event)">
                    <button class="add-button">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                    <div class="product-image-container">
                            <img src="${product[2]}" alt="${product[0]}" class="product-image" 
                                 onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMTZWN00xMiA4djEwTTggMTJoOCIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg=='">
                    </div>
                    <div class="product-name">${product[0]}</div>
                    <div class="product-barcode">${product[1]}</div>
                </div>
            `).join('');

            // Update tombol select all
            const allSelected = category[1].every(product => selectedProducts.has(product[1]));
            selectAllButton.classList.toggle('selected', allSelected);
            selectAllButton.innerHTML = allSelected ? 
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>Hapus Semua` :
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>Pilih Semua`;

            } catch (error) {
                console.error('Error loading category:', error);
                popupProducts.innerHTML = '<div class="error">Error loading products</div>';
            }

            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closeCategoryPopup();
                }
            });
        }

        function closeCategoryPopup() {
            const popup = document.querySelector('.category-popup');
            popup.style.display = 'none';
        }

        // Tambahkan event listener untuk tombol close
        document.querySelector('.close-popup').addEventListener('click', closeCategoryPopup);

        // Tambahkan event listener untuk escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCategoryPopup();
            }
        });

        function toggleProduct(barcode, event) {
            const productItem = event.currentTarget;
            const button = productItem.querySelector('.add-button');
            
            if (selectedProducts.has(barcode)) {
                selectedProducts.delete(barcode);
                productItem.classList.remove('selected');
                button.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>`;
            } else {
                selectedProducts.add(barcode);
                productItem.classList.add('selected');
                button.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>`;
            }
            
            // Update tombol select all
            const categoryName = document.querySelector('.popup-title').textContent;
            const category = categories.find(cat => cat[0] === categoryName);
            const allSelected = category[1].every(product => selectedProducts.has(product[1]));
            const selectAllButton = document.querySelector('.popup-select-all');
            selectAllButton.classList.toggle('selected', allSelected);
            selectAllButton.innerHTML = allSelected ? 
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>Hapus Semua` :
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>Pilih Semua`;
            
            updateSelectedCount();
            saveSelectedProducts();
        }

        // Fungsi untuk update jumlah produk yang dipilih
        function updateSelectedCount() {
            const countElement = document.querySelector('.selected-count');
            const selectedProductsDiv = document.querySelector('.selected-products');
            
            if (selectedProducts.size > 0) {
                countElement.innerHTML = `
                    <span>${selectedProducts.size} Produk Dipilih</span>
                    <div class="button-group">
                        <button class="clear-selection" onclick="clearAllSelection()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                            </svg>
                            Hapus Semua
                        </button>
                        <button class="view-barcode" onclick="showBarcodeView()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M3 7h2v10H3V7zm4 0h2v10H7V7zm4 0h2v10h-2V7zm4 0h2v10h-2V7zm4 0h2v10h-2V7z"/>
                            </svg>
                            Lihat Barcode
                        </button>
                    </div>
                `;
                selectedProductsDiv.style.display = 'block';
            } else {
                selectedProductsDiv.style.display = 'none';
            }
        }

        function clearAllSelection() {
            selectedProducts.clear();
            
            document.querySelectorAll('.add-button').forEach(button => {
                button.classList.remove('selected');
                button.textContent = '+';
            });
            
            document.querySelectorAll('.select-all-button').forEach(button => {
                button.classList.remove('selected');
                button.textContent = '+';
            });
            
            updateSelectedCount();
            saveSelectedCount(); // Simpan setelah menghapus semua
        }

        // Fungsi untuk menampilkan kategori
        function displayCategories() {
            const container = document.querySelector('.categories-container');
            container.innerHTML = categories.map(category => createCategoryCard(category)).join('');
        }

        // Mencegah refresh saat pull-to-refresh
        let touchStartY = 0;
        let touchEndY = 0;
        
        document.addEventListener('touchstart', function(e) {
            touchStartY = e.touches[0].clientY;
        }, { passive: false });

        document.addEventListener('touchmove', function(e) {
            touchEndY = e.touches[0].clientY;
            
            // Jika user mencoba pull-to-refresh
            if (touchStartY < touchEndY && window.scrollY === 0) {
                e.preventDefault();
            }
            
            // Mencegah zoom
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        // Mencegah refresh saat swipe down
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // Mencegah refresh saat double tap
        let lastTap = 0;
        document.addEventListener('touchend', function(e) {
            const currentTime = new Date().getTime();
            const tapLength = currentTime - lastTap;
            if (tapLength < 500 && tapLength > 0) {
                e.preventDefault();
            }
            lastTap = currentTime;
        });

        // Mencegah refresh saat tekan lama
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Simulasi loading
        window.addEventListener('load', function() {
            setTimeout(function() {
                document.querySelector('.loading-container').style.display = 'none';
                document.querySelector('.main-content').style.display = 'block';
                displayCategories();
                loadSelectedProducts(); // Load data yang tersimpan
            }, 3000); // Loading akan berlangsung selama 3 detik
        });

        // Mencegah rotasi ke landscape
        // screen.orientation.lock('portrait').catch(function(error) {
        //     console.log("Orientation lock failed: " + error);
        // });

        // Mencegah refresh saat tombol back
        window.addEventListener('popstate', function(e) {
            e.preventDefault();
            history.pushState(null, null, window.location.href);
        });

        // Menambahkan state ke history saat pertama kali load
        history.pushState(null, null, window.location.href);

        // Simpan data saat halaman akan ditutup
        window.addEventListener('beforeunload', function() {
            saveSelectedProducts();
        });

        let currentBarcodeIndex = 0;
        let selectedProductsArray = [];

        function showBarcodeView() {
            if (selectedProducts.size === 0) return;
            
            selectedProductsArray = Array.from(selectedProducts);
            currentBarcodeIndex = 0;
            updateBarcodeView();
            document.querySelector('.barcode-container').style.display = 'block';
            document.querySelector('.main-content').style.display = 'none';
        }

        function closeBarcodeView() {
            document.querySelector('.barcode-container').style.display = 'none';
            document.querySelector('.main-content').style.display = 'block';
        }

        async function updateBarcodeView() {
            const barcode = selectedProductsArray[currentBarcodeIndex];
            const product = findProductByBarcode(barcode);
            
            if (product) {
                try {
                document.querySelector('.barcode-name').textContent = product.name;
                document.querySelector('.barcode-number').textContent = product.barcode;
                    
                    // Coba ambil barcode dari cache
                    const cachedBarcode = await getCachedBarcode(product.barcode);
                    if (cachedBarcode) {
                        document.querySelector('.barcode-image').src = cachedBarcode;
                    } else {
                document.querySelector('.barcode-image').src = `https://barcodeapi.org/api/code128/${product.barcode}`;
                        // Cache barcode baru
                        await cacheBarcode(product.barcode);
                    }

                    // Coba ambil gambar dari cache
                    const cachedImage = await getCachedImage(product.barcode);
                    if (cachedImage) {
                        document.querySelector('.product-image-barcode').src = cachedImage;
                    } else {
                document.querySelector('.product-image-barcode').src = product.image;
                        // Cache gambar baru
                        await cacheImage(product.image, product.barcode);
                    }
                
                // Update progress bar
                const progress = ((currentBarcodeIndex + 1) / selectedProductsArray.length) * 100;
                document.querySelector('.progress-fill').style.width = `${progress}%`;
                document.querySelector('.progress-text').textContent = 
                    `${currentBarcodeIndex + 1} dari ${selectedProductsArray.length} produk`;
                
                // Update status tombol navigasi
                document.querySelector('.nav-button:first-child').disabled = currentBarcodeIndex === 0;
                document.querySelector('.nav-button:last-child').disabled = currentBarcodeIndex === selectedProductsArray.length - 1;
                } catch (error) {
                    console.error('Error updating barcode view:', error);
                }
            }
        }

        function findProductByBarcode(barcode) {
            for (const category of categories) {
                const product = category[1].find(p => p[1] === barcode);
                if (product) {
                    return {
                        name: product[0],
                        barcode: product[1],
                        image: product[2]
                    };
                }
            }
            return null;
        }

        function nextBarcode() {
            if (currentBarcodeIndex < selectedProductsArray.length - 1) {
                currentBarcodeIndex++;
                updateBarcodeView();
            }
        }

        function previousBarcode() {
            if (currentBarcodeIndex > 0) {
                currentBarcodeIndex--;
                updateBarcodeView();
            }
        }

        function toggleSelectAllPopup(event) {
            const button = event.target.closest('.popup-select-all');
            const isSelected = button.classList.contains('selected');
            const categoryName = document.querySelector('.popup-title').textContent;
            const category = categories.find(cat => cat[0] === categoryName);
            
            category[1].forEach(product => {
                const productItem = document.querySelector(`.product-item[onclick*="${product[1]}"]`);
                if (productItem) {
                    if (!isSelected) {
                        // Pilih semua produk
                        if (!selectedProducts.has(product[1])) {
                            selectedProducts.add(product[1]);
                            productItem.classList.add('selected');
                            productItem.querySelector('.add-button').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M6 18L18 6M6 6l12 12"/>
                            </svg>`;
                        }
                    } else {
                        // Hapus semua produk
                        if (selectedProducts.has(product[1])) {
                            selectedProducts.delete(product[1]);
                            productItem.classList.remove('selected');
                            productItem.querySelector('.add-button').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>`;
                        }
                    }
                }
            });
            
            button.classList.toggle('selected');
            button.innerHTML = isSelected ? 
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>Pilih Semua` :
                `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M6 18L18 6M6 6l12 12"/>
                </svg>Hapus Semua`;
            
            updateSelectedCount();
            saveSelectedProducts();
        }

        document.querySelector('.popup-select-all').addEventListener('click', toggleSelectAllPopup);

        function clearAllSelection() {
            selectedProducts.clear();
            
            // Reset semua produk di popup
            document.querySelectorAll('.product-item').forEach(item => {
                item.classList.remove('selected');
                item.querySelector('.add-button').innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>`;
            });
            
            // Reset tombol select all
            const selectAllButton = document.querySelector('.popup-select-all');
            if (selectAllButton) {
                selectAllButton.classList.remove('selected');
                selectAllButton.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M12 5v14M5 12h14"/>
                </svg>Pilih Semua`;
            }
            
            updateSelectedCount();
            saveSelectedProducts();
        }

        // Mencegah tombol kembali pada Android
        let isFirstLoad = true;
        window.addEventListener('load', function() {
            if (isFirstLoad) {
                history.pushState(null, null, window.location.href);
                isFirstLoad = false;
            }
        });

        window.addEventListener('popstate', function(event) {
            // Mencegah navigasi kembali
            history.pushState(null, null, window.location.href);
            
            // Tampilkan konfirmasi jika user mencoba keluar
            if (document.querySelector('.barcode-container').style.display === 'block') {
                if (confirm('Apakah Anda yakin ingin keluar dari tampilan barcode?')) {
                    closeBarcodeView();
                }
            } else if (document.querySelector('.category-popup').style.display === 'block') {
                if (confirm('Apakah Anda yakin ingin menutup popup?')) {
                    closeCategoryPopup();
                }
            }
        });

        // Tambahkan event listener untuk visibility change
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // Pastikan state history tetap ada
                history.pushState(null, null, window.location.href);
            }
        });

        // Tambahkan event listener untuk beforeunload
        window.addEventListener('beforeunload', function(e) {
            // Simpan data sebelum unload
            saveSelectedProducts();
            
            // Tampilkan konfirmasi jika ada produk yang dipilih
            if (selectedProducts.size > 0) {
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });

        // Tambahkan event listener untuk membersihkan cache saat aplikasi dimuat
        window.addEventListener('load', async function() {
            try {
                // Bersihkan cache lama jika ada
                await caches.delete('image-cache');
                await caches.delete('barcode-cache');
                
                // Buat cache baru
                await caches.open('image-cache');
                await caches.open('barcode-cache');
            } catch (error) {
                console.error('Error initializing cache:', error);
            }
        });

        // Tambahkan fungsi pencarian
        let searchTimeout;
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');

        function highlightText(text, searchTerm) {
            if (!searchTerm) return text;
            const regex = new RegExp(`(${searchTerm})`, 'gi');
            return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function searchProducts(searchTerm) {
            if (!searchTerm) {
                searchResults.style.display = 'none';
                return;
            }

            const results = [];
            searchTerm = searchTerm.toLowerCase();

            categories.forEach(([category, products]) => {
                products.forEach(([name, barcode, image]) => {
                    if (name.toLowerCase().includes(searchTerm) || 
                        barcode.toLowerCase().includes(searchTerm) ||
                        category.toLowerCase().includes(searchTerm)) {
                        results.push({
                            name,
                            barcode,
                            image,
                            category
                        });
                    }
                });
            });

            if (results.length > 0) {
                searchResults.innerHTML = results.map(result => `
                    <div class="search-result-item" onclick="selectSearchResult('${result.barcode}')">
                        <img src="${result.image}" alt="${result.name}" class="search-result-image" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMTIgMTZWN00xMiA4djEwTTggMTJoOCIgc3Ryb2tlPSIjY2NjIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg=='">
                        <div class="search-result-info">
                            <div class="search-result-name">${highlightText(result.name, searchTerm)}</div>
                            <div class="search-result-category">${highlightText(result.category, searchTerm)}</div>
                            <div class="search-result-barcode">${result.barcode}</div>
                        </div>
                    </div>
                `).join('');
                searchResults.style.display = 'block';
            } else {
                searchResults.innerHTML = '<div class="no-results">Tidak ada hasil yang ditemukan</div>';
                searchResults.style.display = 'block';
            }
        }

        function selectSearchResult(barcode) {
            // Cari kategori yang mengandung barcode ini
            const category = categories.find(([_, products]) => 
                products.some(([_, productBarcode]) => productBarcode === barcode)
            );

            if (category) {
                // Auto-select produk tanpa membuka popup
                if (!selectedProducts.has(barcode)) {
                    selectedProducts.add(barcode);
                    
                    // Update tampilan di kategori card jika terlihat
                    const productElement = document.querySelector(`.product-item[onclick*="${barcode}"]`);
                    if (productElement) {
                        productElement.classList.add('selected');
                        const button = productElement.querySelector('.add-button');
                        button.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M6 18L18 6M6 6l12 12"/>
                        </svg>`;
                        
                        // Highlight produk yang dipilih
                        productElement.style.animation = 'pulse 1s';
                        setTimeout(() => {
                            productElement.style.animation = '';
                        }, 1000);
                    }
                    
                    // Update counter dan simpan
                    updateSelectedCount();
                    saveSelectedProducts();

                    // Tampilkan notifikasi singkat
                    const notification = document.createElement('div');
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: #4CAF50;
                        color: white;
                        padding: 10px 20px;
                        border-radius: 20px;
                        font-size: 14px;
                        z-index: 2000;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                        animation: fadeInOut 2s ease-in-out;
                    `;
                    notification.textContent = 'Produk berhasil dipilih';
                    document.body.appendChild(notification);
                    
                    // Hapus notifikasi setelah 2 detik
                    setTimeout(() => {
                        notification.remove();
                    }, 2000);
                }
            }

            // Reset pencarian
            searchInput.value = '';
            searchResults.style.display = 'none';
        }

        // Tambahkan style untuk animasi notifikasi
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -20px); }
                15% { opacity: 1; transform: translate(-50%, 0); }
                85% { opacity: 1; transform: translate(-50%, 0); }
                100% { opacity: 0; transform: translate(-50%, -20px); }
            }
        `;
        document.head.appendChild(style);

        // Event listener untuk input pencarian
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                searchProducts(e.target.value);
            }, 300); // Debounce 300ms
        });

        // Tutup hasil pencarian saat klik di luar
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                searchResults.style.display = 'none';
            }
        });

        // Tambahkan script untuk particles
        function createParticles() {
            const container = document.getElementById('particles');
            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size between 5 and 15px
                const size = Math.random() * 10 + 5;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // Random animation delay
                particle.style.animationDelay = `${Math.random() * 3}s`;
                
                container.appendChild(particle);
            }
        }

        // Panggil createParticles saat halaman dimuat
        window.addEventListener('load', function() {
            createParticles();
            setTimeout(function() {
                document.querySelector('.loading-container').style.display = 'none';
                document.querySelector('.main-content').style.display = 'block';
                displayCategories();
                loadSelectedProducts();
            }, 3000);
        });
    </script>
</body>
</html>
